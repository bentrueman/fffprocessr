) %>%
correct_baseline(left = 10, right = 35)
data %>%
ggplot(aes(time, conc, col = sample)) +
facet_wrap(vars(param), scales = "free_y") +
geom_line()
data
data %>% distinct(param, three_sigma)
?integrate_peak
data %>%
group_by(param, sample) %>%
summarize(area = integrate_peak(time, conc, injvol = 5e4))
1.44e- 6
data %>%
filter(time > 10) %>%
group_by(param, sample) %>%
summarize(area = integrate_peak(time, conc, injvol = 5e4))
?integrate_peak
data %>%
filter(time > 10) %>%
group_by(sample, param) %>%
summarize(conc_ppb = integrate_peak(time, conc))
data %>%
filter(
time > 10,
param %in% c("55Mn", "56Fe")
) %>%
group_by(sample, param) %>%
summarize(conc_ppb = integrate_peak(time, conc))
data %>%
filter(
time > 10, # exclude the focus period
param %in% c("55Mn", "56Fe") # select parameters of interest
) %>%
group_by(sample, param) %>%
summarize(conc_ppb = integrate_peak(time, conc))
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%",
dpi = 600
)
# rmarkdown::render("README.Rmd", "md_document")
library("fffprocessr")
library("tidyverse")
theme_set(theme_classic() + theme(strip.background = element_blank()))
icp_data <- system.file("extdata", package = "fffprocessr") %>%
load_icp(calibrate = TRUE)
icp_data
uv_data <- system.file("extdata", package = "fffprocessr") %>%
load_uv(UV254_1, UV254_2, LS90) # name channels in order from left to right
uv_data
data <- combine_fff(
icp_data,
uv_data,
subtract_blank = TRUE,
focus = 10
) %>%
correct_baseline(left = 10, right = 35)
data %>%
filter(
time > 10, # exclude the focus period
param %in% c("55Mn", "56Fe") # select parameters of interest
) %>%
group_by(sample, param) %>%
summarize(conc_ppb = integrate_peak(time, conc))
data %>%
filter(time > 5, time < 37.5, param != "UV254_1") %>%
mutate(
param = fct_recode(param, "UV254" = "UV254_2"),
param = str_remove(param, "^\\d+") %>%
str_replace("([:alpha:]+)(\\d+)$", "\\1[\\2]")
) %>%
ggplot(aes(time, conc, col = sample)) +
facet_wrap(vars(param), scales = "free_y", ncol = 2, labeller = label_parsed) +
geom_hline(yintercept = 0, col = "grey", linetype = 3) +
geom_line() +
scale_colour_manual(values = c("firebrick", "grey")) +
theme(legend.position = "bottom") +
labs(x = "Retention time (min.)", y = "Detector response", col = NULL)
mals <- system.file("extdata/mals", package = "fffprocessr") %>%
load_mals() %>%
correct_baseline(4, 65)
mals %>%
mutate(param = str_to_upper(param) %>% str_replace("([:alpha:]+)(\\d+)$", "\\1[\\2]")) %>%
ggplot(aes(time, conc)) +
facet_wrap(
vars(fct_reorder(param, str_extract(param, "\\d+") %>% as.numeric())),
scales = "free_y", labeller = label_parsed
) +
geom_hline(yintercept = 0, col = "grey", linetype = 3) +
geom_line() +
labs(x = "Retention time (min.)", y = "Detector response", col = NULL)
knitr::include_graphics("man/figures/CodeCogsEqn.png", dpi = 500)
knitr::include_graphics("man/figures/CodeCogsEqn_2.png", dpi = 500)
mals_rg <- mals %>%
filter(
time > 10,
param != "ls7"
) %>%
calculate_rg(window = .05, method = "zimm")
mals_rg %>%
filter(param == "ls90") %>%
pivot_longer(c(rg_zimm, conc)) %>%
mutate(name = fct_recode(name, "LS[90]" = "conc", "r[g]~(nm)" = "rg_zimm")) %>%
ggplot(aes(time, value)) +
facet_wrap(vars(name), scales = "free_y", ncol = 2, labeller = label_parsed) +
geom_point(data = function(x) filter(x, name == "r[g]~(nm)", time < 60), alpha = .2, shape = 16) +
geom_line(data = function(x) filter(x, name == "LS[90]")) +
geom_hline(yintercept = 0, col = "grey", linetype = 3) +
labs(x = "Retention time (min.)", y = NULL, col = NULL)
mals_rg %>%
filter(timeslice %in% c(17.1, 24.1, 40)) %>%
distinct(timeslice, rg_zimm) %>%
mutate(d_geom = 2 * rg_zimm / sqrt(3/5))
mals_rg %>%
filter(timeslice %in% c(17.1, 24.1, 40)) %>%
mutate(
timeslice = paste(timeslice, "min."),
x = sin(pi * theta / 360) ^ 2,
y = 1 / rayleigh_ratio
) %>%
ggplot(aes(x, y)) +
facet_wrap(vars(timeslice), scales = "free_y") +
geom_smooth(method = "lm") +
geom_point() +
labs(x = expression("sin"^2*"("*theta*"/2)"), y = "1/R")
mals %>%
filter(
time > 39,
param != "ls7"
) %>%
calculate_rg(window = .05, method = "watt") %>%
filter(timeslice == 40) %>%
distinct(rg_watt) %>%
mutate(d_geom = 2 * rg_watt / sqrt(3/5))
data %>%
filter(param == "65Cu", time > 10.5, time < 16) %>%
mutate(dh = 2 * 1e9 * calculate_rh(time) ) %>%
ggplot(aes(dh, conc, col = sample)) +
geom_line() +
scale_colour_manual(values = c("firebrick", "grey")) +
labs(x = "Calculated hydrodynamic diameter (nm)", y = "[Cu] (µg/L)", col = NULL)
# load a calibration curve:
mw_data <- system.file("extdata/mw_calibration", package = "fffprocessr") %>%
list.files(full.names = TRUE) %>%
read_csv()
mw_data %>%
with(calibrate_mw(peak_retention_time, mw_kda, type = "quadratic", predict = FALSE))
mw_data %>%
with(
calibrate_mw(
peak_retention_time,
mw_kda,
type = "quadratic", # or "linear"
newdata = c(1, 10, 100, 1000), # molecular weights (or time if output = "mw")
output = "time", # or "mw"
predict = TRUE
)
)
knitr::include_graphics("man/figures/CodeCogsEqn_1.png", dpi = 500)
knitr::include_graphics("man/figures/CodeCogsEqn_3.png", dpi = 500)
deconvolved <- data %>%
filter(param == "65Cu", time > 10) %>%
group_by(date, param, sample) %>%
nest() %>%
ungroup() %>%
mutate(
model = map(
data,
~ deconvolve_fff(
.x$time, .x$conc,
# these are the initial guesses for the model parameters
h = c(.8, .6, .2), mu = c(11, 14, 20), s = c(1, 1, 1), g = c(1, 2, 5),
fn = "skew_gaussian"
)
),
fitted = map(model, "fitted"),
peaks = map(model, "peaks")
)
deconvolved %>%
unnest(c(data, fitted, peaks)) %>%
pivot_longer(c(conc, fitted, starts_with("peak"))) %>%
ggplot(aes(time, value, col = name, size = name)) +
facet_wrap(vars(sample)) +
scale_colour_manual(
values = c("black", "firebrick", "grey", "grey", "grey"),
labels = function(breaks) str_replace(breaks, "conc", "data")
) +
scale_size_manual(
values = c(1, 2, .5, .5, .5),
labels = function(breaks) str_replace(breaks, "conc", "data")
) +
geom_line() +
labs(x = "Retention time (min.)", y = "[Cu] (µg/L)", col = NULL, size = NULL)
deconvolved_emg <- data %>%
filter(param == "56Fe", time > 10, sample == "sample_bennery_raw") %>%
group_by(date, param, sample) %>%
nest() %>%
ungroup() %>%
mutate(
model = map(
data,
~ deconvolve_fff(
.x$time, .x$conc,
# these are the initial guesses for the model parameters
h = c(35, 50, 8), mu = c(14, 20, 28), s = c(1, 1, 1), g = c(1, 1, .5),
fn = "emg"
)
),
fitted = map(model, "fitted"),
peaks = map(model, "peaks")
)
deconvolved_emg %>%
unnest(c(data, fitted, peaks)) %>%
pivot_longer(c(conc, fitted, starts_with("peak"))) %>%
ggplot(aes(time, value, col = name, size = name)) +
scale_colour_manual(
values = c("black", "firebrick", "grey", "grey", "grey"),
labels = function(breaks) str_replace(breaks, "conc", "data")
) +
scale_size_manual(
values = c(1, 1, .5, .5, .5),
labels = function(breaks) str_replace(breaks, "conc", "data")
) +
geom_line() +
labs(x = "Retention time (min.)", y = "[Fe] (µg/L)", col = NULL, size = NULL)
deconvolved %>%
unnest(c(data, starts_with("peak"))) %>%
pivot_longer(starts_with("peak"), names_to = "peak") %>%
group_by(date, sample, param, peak) %>%
summarize(conc_ppb = integrate_peak(time, value, injvol = 0.001, flowrate = 0.001))
rmarkdown::render("README.Rmd", "md_document")
rmarkdown::render("README.Rmd", "md_document")
rmarkdown::render("README.Rmd", "md_document")
library("devtools")
document()
?use_package()
use_package("here")
document()
?load_direct_quant
path <- system.file("extdata", package = "fffprocessr")
load_direct_quant(path = paste0(path, "/direct_quantification"))
?load_all
document()
load_all()
?load_direct_quant()
check()
rmarkdown::render("README.Rmd", "md_document")
rmarkdown::render("README.Rmd", "md_document")
document()
check()
rmarkdown::render("README.Rmd", "md_document")
library(devtools)
document()
load_all()
?peak_maxima
path <- system.file("extdata", package = "fffprocessr")
data <- combine_fff(load_icp(path))
data <- data[data$param == "65Cu", ]
peak_maxima(data, peaks = 3)
document()
load_all()
path <- system.file("extdata", package = "fffprocessr")
data <- combine_fff(load_icp(path))
data <- data[data$param == "65Cu", ]
peak_maxima(data, peaks = 3)
path <- system.file("extdata", package = "fffprocessr")
data <- combine_fff(load_icp(path))
data <- data[data$param == "65Cu", ]
peak_maxima(data, peaks = 3, method = "sigma")
document()
check()
library(devtools)
document()
check()
library(devtools)
use_r("peak_maxima")
document()
check()
library(devtools)
document()
check()
library("devtools")
?message
document()
?load_icp
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
document()
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
document()
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path) -> test
test
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path) -> test
?return
document()
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path) -> test
test
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
document()
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
document()
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
document()
document()
check()
library(testthat)
path <- system.file("extdata", package = "fffprocessr")
test_that("combine_fff() yields same number of rows as load_...() fns", {
icp_data <- load_icp(path)
uv_data <- load_uv(path, UV254_1, UV254_2, LS90)
expect_equal(
nrow(combine_fff(icp_data, uv_data)),
sum(
nrow(dplyr::filter(icp_data, sample != "blank")),
nrow(dplyr::filter(uv_data, sample != "blank"))
)
)
})
test_that("combine_fff() yields expected column means", {
expect_equal(
dplyr::summarize_if(
combine_fff(load_icp(path), load_uv(path, UV254_1, UV254_2, LS90)) %>% filter(!param %in% c("45Sc", "115In", "159Tb")),
is.numeric, ~ round(mean(.x), 1)
),
tibble::tibble(time = 19, conc = 1.1, three_sigma = .5)
)
})
document()
source("~/Documents/GitHub/fffprocessr/tests/testthat.R", echo=TRUE)
check()
?load_icp
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
document()
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
check()
document()
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
2 %in% 1:10
2 %in% 1:29
2:3 %in% 1:29
TRUE & (2:3 %in% 1:29)
if(TRUE & (2:3 %in% 1:29)) 23
mean(1:2 %in% 1:20) == 0
mean(1:2 %in% 3:20) == 0
mean(1:2 %in% 1:20) == 0
TRUE & mean(1:2 %in% 1:20) == 0
TRUE & mean(1:2 %in% 3:20) == 0
document()
if(
calibrate & mean(unique(calib$date) %in% unique(data$date)) == 0
) stop(
"No calibration file dates match data file dates"
)
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
check()
library(devtools)
document()
load_icp
?load_icp
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path) %>% distinct(date)
library("tidyverse")
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path) %>% distinct(date)
document()
check()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%",
dpi = 600
)
options(dplyr.summarise.inform = FALSE)
# rmarkdown::render("README.Rmd", "md_document")
library("fffprocessr")
library("tidyverse")
theme_set(theme_classic() + theme(strip.background = element_blank()))
system.file("extdata", package = "fffprocessr")
icp_data <- system.file("extdata", package = "fffprocessr") %>%
load_icp(calibrate = TRUE)
icp_data
uv_data <- system.file("extdata", package = "fffprocessr") %>%
load_uv(UV254_1, UV254_2, LS90) # name channels in order from left to right
uv_data
data <- combine_fff(
icp_data,
uv_data,
subtract_blank = TRUE,
focus = 10
) %>%
correct_baseline(left = 10, right = 35)
data %>%
filter(time > 5, time < 37.5) %>%
ggplot(aes(time, conc, col = sample)) +
facet_wrap(vars(param), scales = "free_y", ncol = 2) +
geom_hline(yintercept = 0, col = "grey", linetype = 3) +
geom_line()
data %>%
filter(time > 5, time < 37.5, param != "UV254_1") %>%
mutate(
param = fct_recode(param, "UV254" = "UV254_2"),
param = str_remove(param, "^\\d+") %>%
str_replace("([:alpha:]+)(\\d+)$", "\\1[\\2]")
) %>%
ggplot(aes(time, conc, col = sample)) +
facet_wrap(vars(param), scales = "free_y", ncol = 2, labeller = label_parsed) +
geom_hline(yintercept = 0, col = "grey", linetype = 3) +
geom_line() +
scale_colour_manual(values = c("firebrick", "grey")) +
theme(legend.position = "bottom") +
labs(x = "Retention time (min.)", y = "Detector response", col = NULL)
data %>%
filter(
time > 10, # exclude the focus period
param %in% c("55Mn", "56Fe") # select parameters of interest
) %>%
group_by(sample, param) %>%
summarize(conc_ppb = integrate_peak(time, conc))
mals <- system.file("extdata/mals", package = "fffprocessr") %>%
load_mals() %>%
correct_baseline(4, 65)
mals %>%
ggplot(aes(time, conc)) +
facet_wrap(vars(param), scales = "free_y") +
geom_hline(yintercept = 0, col = "grey", linetype = 3) +
geom_line()
mals %>%
filter(
time > 39,
param != "ls7"
) %>%
calculate_rg(window = .05, method = "watt") %>%
filter(timeslice == 40) %>%
distinct(rg_watt) %>%
mutate(d_geom = 2 * rg_watt / sqrt(3/5))
data %>%
filter(param == "65Cu", time > 10.5, time < 16) %>%
mutate(dh = 2 * 1e9 * calculate_rh(time)) %>%
ggplot(aes(dh, conc, col = sample)) +
geom_line()
data %>%
filter(param == "65Cu", time > 10.5, time < 16) %>%
mutate(dh = 2 * 1e9 * calculate_rh(time) ) %>%
ggplot(aes(dh, conc, col = sample)) +
geom_line() +
scale_colour_manual(values = c("firebrick", "grey")) +
labs(x = "Calculated hydrodynamic diameter (nm)", y = "[Cu] (µg/L)", col = NULL)
# load a calibration curve:
mw_data <- system.file("extdata/mw_calibration", package = "fffprocessr") %>%
list.files(full.names = TRUE) %>%
read_csv()
mw_data %>%
with(calibrate_mw(peak_retention_time, mw_kda, type = "quadratic", predict = FALSE))
mw_kda
# load a calibration curve:
mw_data <- system.file("extdata/mw_calibration", package = "fffprocessr") %>%
list.files(full.names = TRUE) %>%
read_csv()
mw_data %>%
with(calibrate_mw(peak_retention_time, mw_kda, type = "quadratic", predict = FALSE))
?calibrate_mw
mw_kda
mw_data %>%
with(calibrate_mw(peak_retention_time, type = "quadratic", predict = FALSE))
mw_data %>%
with(calibrate_mw(peak_retention_time, mw_kda, type = "quadratic", predict = FALSE))
fffprocessr::mw_kda
mw_data
# load a calibration curve:
mw_data <- system.file("extdata/mw_calibration", package = "fffprocessr") %>%
list.files(full.names = TRUE) %>%
read_csv()
mw_data %>%
with(calibrate_mw(peak_retention_time, mw_kda, type = "quadratic", predict = FALSE))
# load a calibration curve:
mw_data <- system.file("extdata/mw_calibration", package = "fffprocessr") %>%
list.files(full.names = TRUE) %>%
read_csv()
mw_data %>%
with(calibrate_mw(peak_retention_time, mw_kda, type = "quadratic", predict = FALSE))
mw_data %>%
with(
calibrate_mw(
peak_retention_time,
mw_kda,
type = "quadratic", # or "linear"
newdata = c(1, 10, 100, 1000), # molecular weights (or time if output = "mw")
output = "time", # or "mw"
predict = TRUE
)
)
?with
rmarkdown::render("README.Rmd", "md_document")

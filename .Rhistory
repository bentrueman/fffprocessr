data <- data[data$param == "65Cu" & data$sample == "sample_bennery_raw", ]
peak_maxima(data, peaks = 3)
check()
path <- system.file("extdata", package = "fffprocessr")
data <- combine_fff(load_icp(path))
data <- data[data$param == "65Cu" & data$sample == "sample_bennery_raw", ]
peak_maxima(data, peaks = 3)
build_readme()
build_readme()
library(devtools)
load_all()
?peak_maxima
document()
load_all()
path <- system.file("extdata", package = "fffprocessr")
data <- combine_fff(load_icp(path))
data <- data[data$param == "65Cu" & data$sample == "sample_bennery_raw", ]
peak_maxima(data, peaks = 3)
path <- system.file("extdata", package = "fffprocessr")
data <- combine_fff(load_icp(path))
data <- data[data$param == "65Cu", ]
peak_maxima(data, peaks = 3)
document()
path <- system.file("extdata", package = "fffprocessr")
data <- combine_fff(load_icp(path))
data <- data[data$param == "65Cu", ]
peak_maxima(data, peaks = 3)
data
library("tidyverse")
data %>% ggplot(aes(time, conc, col = sample)) +
geom_line()
data %>% ggplot(aes(time, conc, col = sample)) + geom_line() + geom_point(data = function(x) peak_maxima(x, peaks = 3), aes(tr, conc_tr))
data %>% ggplot(aes(time, conc, col = sample)) + geom_line() + geom_point(data = function(x) peak_maxima(x, peaks = 3, k = 30), aes(tr, conc_tr))
data %>% ggplot(aes(time, conc, col = sample)) + geom_line() + geom_point(data = function(x) peak_maxima(x, peaks = 3, k = 40), aes(tr, conc_tr))
data %>% ggplot(aes(time, conc, col = sample)) + geom_line() + geom_point(data = function(x) peak_maxima(x, peaks = 3, k = 35), aes(tr, conc_tr))
document()
load_all()
?peak_maxima
path <- system.file("extdata", package = "fffprocessr")
data <- combine_fff(load_icp(path))
data <- data[data$param == "65Cu", ]
peak_maxima(data, peaks = 3)
check()
library(devtools)
use_r("calibrate_mw")
document()
check()
devtools()
library(devtools)
load_all()
calibrate_mw
?calibrate_mw
retention <- c(11.35890, 19.49773, 19.24173, 13.88310, 18.73001, 17.67315)
mw_kda <- c(0.69, 2000.00, 440.00, 1.80, 158.00, 44.00)
# return tick positions for 1, 10, 100, and 1000 kDa,
# based on a quadratic calibration curve:
calibrate_mw(retention, mw_kda, type = "linear", newdata = c(1, 10, 100, 1000), predict = TRUE)
library(devtools)
use_r("load_icp")
library(tidyverse)
tibble(x = 1, y = 1)
(tibble(x = 1, y = 1))[-1, ]
(tibble(x = 1, y = 1))[-seq_len(1), ]
(tibble(x = runif(10), y = runif(10)))[-seq_len(1), ]
seq_len(0)
(tibble(x = runif(10), y = runif(10)))[-seq_len(0), ]
(tibble(x = runif(10), y = runif(10)))[-seq_len(1), ]
(tibble(x = runif(10), y = runif(10)))[-seq_len(2), ]
(tibble(x = 1:10, y = runif(10)))[-seq_len(2), ]
(tibble(x = 1:10, y = runif(10)))[-0, ]
(tibble(x = 1:10, y = runif(10)))[, ]
(tibble(x = 1:10, y = runif(10)))[NULL, ]
(tibble(x = 1:10, y = runif(10)))[NA, ]
(tibble(x = 1:10, y = runif(10)))[, ]
(tibble(x = 1:10, y = runif(10)))[, ]
?seq_along
seq_along(1:10)
seq_along(letters[1:3])
?tail
tibble(x = 1:10, y = runif(10))
tibble(x = 1:10, y = runif(10)) %>% tail(-1)
tibble(x = 1:10, y = runif(10)) %>% tail(-2)
tibble(x = 1:10, y = runif(10)) %>% tail(-3)
?load_icp
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
load_all()
load_icp
document()
?load_icp
document()
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path, metadata = 0)
tibble(x = 1:10, y = runif(10)) %>% tail(-3)
tibble(x = 1:10, y = runif(10)) %>% tail(-0)
tibble(x = 1:10, y = runif(10)) %>% tail(0)
tibble(x = 1:10, y = runif(10)) %>% tail()
tibble(x = 1:10, y = runif(10)) %>% tail(NULL)
?tail
(tibble(x = 1:10, y = runif(10)))[,]
(tibble(x = 1:10, y = runif(10)))["",]
(tibble(x = 1:10, y = runif(10)))[,]
(tibble(x = 1:10, y = runif(10))) %>% tail(0L)
(tibble(x = 1:10, y = runif(10))) %>% tail(-1)
(tibble(x = 1:10, y = runif(10))) %>% tail(NA)
(tibble(x = 1:10, y = runif(10))) %>% tail(dim(.))
x <- dim(.)
x <- dim()
tibble(x = 1:10, y = runif(10)) %>% slice(-1)
tibble(x = 1:10, y = runif(10)) %>% slice(NULL)
?slice
tibble(x = 1:10, y = runif(10)) %>% filter()
tibble(x = 1:10, y = runif(10)) %>% filter(NULL)
tibble(x = 1:10, y = runif(10)) %>% filter(NA)
tibble(x = 1:10, y = runif(10)) %>% filter()
tibble(x = 1:10, y = runif(10)) %>% filter(x != 1)
tibble(x = 1:10, y = runif(10)) %>% filter(rownumber() != 1)
tibble(x = 1:10, y = runif(10)) %>% filter(row_number() != 1L)
tibble(x = 1:10, y = runif(10)) %>% filter(row_number() != 0)
tibble(x = 1:10, y = runif(10)) %>% filter(row_number() != 0L)
tibble(x = 1:10, y = runif(10)) %>% filter(row_number() != 0)
tibble(x = 1:10, y = runif(10)) %>% filter(row_number() %in% 0)
tibble(x = 1:10, y = runif(10)) %>% filter(!row_number() %in% 0)
tibble(x = 1:10, y = runif(10)) %>% filter(!row_number() %in% 1)
tibble(x = 1:10, y = runif(10)) %>% filter(!row_number() %in% seq_len(2))
document()
load_all()
load_icp
?load_icp
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path, metadata = 0)
list.files(path = path, pattern = "*.csv", full.names = TRUE) %>%
rlang::set_names() %>%
purrr::map_dfr(
~ readr::read_csv(.x, col_types = readr::cols(.default = readr::col_character())) %>%
# remove metadata after column names but before data:
filter(!row_number() %in% seq_len(0)),
.id = "file"
)
list.files(path = path, pattern = "*.csv", full.names = TRUE) %>%
rlang::set_names() %>%
purrr::map(
~ readr::read_csv(.x, col_types = readr::cols(.default = readr::col_character())) %>%
# remove metadata after column names but before data:
filter(!row_number() %in% seq_len(0)),
.id = "file"
)
document()
check()
?row_number
document()
check()
?load_icp
path <- system.file("extdata", package = "fffprocessr")
load_icp(path = path)
use_r("deconvolve_fff")
gaussian <- function(x, h, mu, s, g) {
h * exp(-(x - mu) ^ 2 / (2 * s ^ 2))
}
gaussian(x=1, h=1, mu=1, g=1)
gaussian(x=1, h=1, mu=1, s=1, g=)
gaussian(x=1, h=1, mu=1, s=1, g=1)
?gaussian
?normal
fn <- "test"
sum(fn %in% c("skew_gaussian", "emg", "normal"))
fn <- "emg"
sum(fn %in% c("skew_gaussian", "emg", "normal"))
document()
load_all()
?deconvolve_fff
set.seed(0)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1))
set.seed(0)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1), fn = "normal")
set.seed(1)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1), fn = "normal")
set.seed(2)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1), fn = "normal")
set.seed(3)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1), fn = "normal")
set.seed(4)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1), fn = "normal")
set.seed(400)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1), fn = "normal")
set.seed(400)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(.5, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1), fn = "normal")
set.seed(400)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1), fn = "normal")
h = c(1, 1); mu = c(3, 7); s = c(1, 1); g = c(1, 1)
inputs <- c("h", "mu", "s", "g")
c_inputs <- function(input, number) paste(c("x", paste0(input, number)), collapse = ", ")
c_inputs
rename_inputs <- function(x) {
names(x) <- paste0(deparse(substitute(x)), seq_len(length(x)))
x
}
start_vals <- as.list(
c(rename_inputs(h), rename_inputs(mu),
rename_inputs(s), rename_inputs(g))
)
start_vals
formula <- stats::reformulate(
termlabels = purrr::map_chr(
seq_len(peaks),
~ paste0(paste0(paste0(fn, "("), c_inputs(inputs, .x)), ")")
),
response = "y"
)
set.seed(400)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1), fn = "normal")
peaks <- 2
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = algorithm,
control = stats::nls.control(maxiter = iter, tol = tol)
)
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = "port",
control = stats::nls.control(maxiter = 300, tol = .1)
)
formula <- stats::reformulate(
termlabels = purrr::map_chr(
seq_len(peaks),
~ paste0(paste0(paste0(fn, "("), c_inputs(inputs, .x)), ")")
),
response = "y"
)
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = "port",
control = stats::nls.control(maxiter = 300, tol = .1)
)
fn <- "normal"
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = algorithm,
control = stats::nls.control(maxiter = iter, tol = tol)
)
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = "port",
control = stats::nls.control(maxiter = 300, tol = .1)
)
formula
fn
formula <- stats::reformulate(
termlabels = purrr::map_chr(
seq_len(peaks),
~ paste0(paste0(paste0(fn, "("), c_inputs(inputs, .x)), ")")
),
response = "y"
)
formula
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = algorithm,
control = stats::nls.control(maxiter = iter, tol = tol)
)
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = "port",
control = stats::nls.control(maxiter = 300, tol = .1)
)
# for nls formula:
normal <- function(x, h, mu, s, g) {
h * exp(-(x - mu) ^ 2 / (2 * s ^ 2))
}
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = "port",
control = stats::nls.control(maxiter = 300, tol = .1)
)
start_vals
start_vals[1:6]
model <- stats::nls(
formula = formula,
start = start_vals[1:6],
algorithm = "port",
control = stats::nls.control(maxiter = 300, tol = .1)
)
formula
# for nls formula:
normal <- function(x, h, mu, s) {
h * exp(-(x - mu) ^ 2 / (2 * s ^ 2))
}
formula <- stats::reformulate(
termlabels = purrr::map_chr(
seq_len(peaks),
~ paste0(paste0(paste0(fn, "("), c_inputs(inputs, .x)), ")")
),
response = "y"
)
formula <- stats::reformulate(
termlabels = purrr::map_chr(
seq_len(peaks),
~ paste0(paste0(paste0(fn, "("), c_inputs(inputs, .x)), ")")
),
response = "y"
)
formula
stats::nls(
formula = formula,
start = start_vals,
algorithm = algorithm,
control = stats::nls.control(maxiter = iter, tol = tol)
)
stats::nls(
formula = formula,
start = start_vals,
algorithm = algorithm,
control = stats::nls.control(maxiter = iter, tol = tol)
)algorithm = "port";
iter = 300; tol = 1e-1
algorithm = "port";
iter = 300; tol = 1e-1
formula <- stats::reformulate(
termlabels = purrr::map_chr(
seq_len(peaks),
~ paste0(paste0(paste0(fn, "("), c_inputs(inputs, .x)), ")")
),
response = "y"
)
formula
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = algorithm,
control = stats::nls.control(maxiter = iter, tol = tol)
)
c_inputs <- function(input, number) paste(c("x", paste0(input, number)), collapse = ", ")
c_inputs
# for nls formula:
normal <- function(x, h, mu, s, g) {
h * exp(-(x - mu) ^ 2 / (2 * s ^ 2))
}
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = algorithm,
control = stats::nls.control(maxiter = iter, tol = tol)
)
model <- stats::nls(
formula = formula,
start = start_vals[1:6],
algorithm = algorithm,
control = stats::nls.control(maxiter = iter, tol = tol)
)
formula
fn
inputs <- if(fn == "normal") c("h", "mu", "s") else c("h", "mu", "s", "g")
inputs
c_inputs <- function(input, number) paste(c("x", paste0(input, number)), collapse = ", ")
rename_inputs <- function(x) {
names(x) <- paste0(deparse(substitute(x)), seq_len(length(x)))
x
}
start_vals <- as.list(
c(rename_inputs(h), rename_inputs(mu),
rename_inputs(s), rename_inputs(g))
)
start_vals
inputs
c_inputs(inputs, 1)
formula <- stats::reformulate(
termlabels = purrr::map_chr(
seq_len(peaks),
~ paste0(paste0(paste0(fn, "("), c_inputs(inputs, .x)), ")")
),
response = "y"
)
formula
normal
# for nls formula:
normal <- function(x, h, mu, s) {
h * exp(-(x - mu) ^ 2 / (2 * s ^ 2))
}
x
y
model <- stats::nls(
formula = formula,
start = start_vals,
algorithm = algorithm,
control = stats::nls.control(maxiter = iter, tol = tol)
)
model <- stats::nls(
formula = formula,
start = start_vals[1:6],
algorithm = algorithm,
control = stats::nls.control(maxiter = iter, tol = tol)
)
modle
model
start_vals <- as.list(
c(rename_inputs(h), rename_inputs(mu),
rename_inputs(s), rename_inputs(g))
)
start_vals
inputs
map(start_vals, ~ str_detect(.x, inputs))
inputs
paste(inputs, collapse = "|")
map(start_vals, ~ str_detect(.x, paste(inputs, collapse = "|")))
map(start_vals, ~ str_detect(.x, "s"))
map(start_vals, ~ str_detect(name(.x), "s"))
map(start_vals, ~ str_detect(names(.x), "s"))
names(start_vals)
names(start_vals) %>% str_detect(paste(inputs, collapse = "|"))
start_vals[names(start_vals) %>% str_detect(paste(inputs, collapse = "|"))]
start_vals <- as.list(
c(rename_inputs(h), rename_inputs(mu),
rename_inputs(s), rename_inputs(g))
)
start_vals
start_vals[names(start_vals) %>% stringr::str_detect(paste(inputs, collapse = "|"))]
filter_vals <- names(start_vals) %>% stringr::str_detect(paste(inputs, collapse = "|"))
filter_vals
document()
?deconvolve_fff
document()
?deconvolve_fff
set.seed(0)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1))
set.seed(0)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), fn = "normal")
document()
set.seed(0)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), fn = "normal")
document()
set.seed(0)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), fn = "normal")
set.seed(0)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1, 1))
set.seed(0)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), g = c(1,1), fn = "normal")
document()
check()
?deconvolve_fff
set.seed(0)
x <- seq(0, 10, length.out = 100)
# two gaussian peaks:
y <- exp(-(x - 3) ^ 2 / 2) + exp(-(x - 7) ^ 2 / 2) + rnorm(100, 0, .1)
deconvolve_fff(x, y, h = c(1, 1), mu = c(3, 7), s = c(1, 1), fn = "normal")
load_all()
?load_icp
use_r("load_icp")
check()
document()
check()
build_readme()
build_readme()
